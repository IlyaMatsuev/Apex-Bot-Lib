@RestResource(urlMapping='%path%/*')
global class %className% {

    @HttpPost
    global static void post() {
        RestRequest request = RestContext.request;
        RestResponse response = RestContext.response;
        Bot__c registration = getRegistrationByToken(request.requestURI.substringAfterLast(CalloutHelper.SLASH));
        BotRequestDelegator delegator = BotRequestDelegator.getDelegator(registration.Type__c);
        response.responseBody = Blob.valueOf(delegator.delegate(request, registration));
    }

    private static Bot__c getRegistrationByToken(String hashedToken) {
        List<Bot__c> registration = [
               SELECT Name, Type__c, WebHookUrl__c, NotifyOnError__c, Token__c
               FROM Bot__c
               WHERE TokenHash__c = :hashedToken
               LIMIT 1
        ];
        if (registration.isEmpty()) {
            throw new BotRegistrationException(Label.NoBotRegistrationError);
        }
        return registration.get(0);
    }
}
